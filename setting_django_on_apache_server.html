<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>setting_django_on_apache_server</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="LucasWei">

    <!-- Le styles -->
    <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="/theme/css/font-awesome.css" rel="stylesheet">

    <link href="/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png">

    <link href="/" type="application/atom+xml" rel="alternate" title="Lucas's 部落格 ATOM Feed" />
    
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/index.html">Lucas's 部落格 </a>
          <div class="nav-collapse">
            <ul class="nav">
                                                                    <li class="divider-vertical"></li>
                                              <li class="active">
                    <a href="/category/python.html">
						<i class="icon-folder-open icon-large"></i>Python
					</a>
                  </li>
                                <li >
                    <a href="/category/sql.html">
						<i class="icon-folder-open icon-large"></i>SQL
					</a>
                  </li>
              
                          <ul class="nav pull-right">
                                <li><a href="/archives.html"><i class="icon-th-list"></i>Archives</a></li>
                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
            <section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to setting_django_on_apache_server">
                                        setting_django_on_apache_server
                                </a>
                                                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
                        <footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2013-08-17T23:50:00">
        <i class="icon-calendar"></i>Sat 17 August 2013
</abbr>
<span class="label">By</span>
<a href="/author/lucaswei.html"><i class="icon-user"></i>LucasWei</a>
<span class="label">Category</span>
<a href="/category/python.html"><i class="icon-folder-open"></i>Python</a>.


<span class="label">Tags</span>
	<a href="/tag/django.html"><i class="icon-tag"></i>Django</a>
	<a href="/tag/ubuntu.html"><i class="icon-tag"></i>Ubuntu</a>
</footer><!-- /.post-info -->                </div>
                <p>如果有在ubuntu上架設過LAMP的應該都知道，其實就是幾個指令，設定好密碼，還可以裝個phpmyadmin來管理資料庫，他的方便性大大降低了他的門檻，本著如此方便的精神，我覺得「安裝Django應該也很簡單吧？」就開始這段錯誤的過程，因為python不算是native支援網頁顯示的，使用一些module，或是使用以前CGI的方式來讓apache驅動他，外加上Django其實是包好好的Framework，所以在設定上就有這麼不人性點。所以，經過這麼多波折，我決定把這些過程記錄下來XD。</p>
<h1>環境設定</h1>
<p>首先，你需要
1. 安裝server，並且安裝wsgi的module</p>
<div class="highlight"><pre>    <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">apache2</span> <span class="n">libapache2</span><span class="o">-</span><span class="n">mod</span><span class="o">-</span><span class="n">wsgi</span>
</pre></div>


<ol>
<li>
<p>安裝<a href="http://www.openfoundry.org/tw/tech-column/8536-introduction-of-python-extension-management-tools">python pip</a></p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">setuptools</span>
</pre></div>


<ol>
<li>
<p>最後，再用pip安裝Django，之後的問題就隨之而來了（誤</p>
<p>sudo pip install django</p>
</li>
</ol>
</li>
</ol>
<p>之後，在你想要撰寫的目錄下，新增一個資料夾，用來管理之後的程式（我是在家目錄底下新增/home/lucas/django）</p>
<div class="highlight"><pre>    <span class="n">mkdir</span> <span class="o">~/</span><span class="n">django</span>
</pre></div>


<h1>IP設定</h1>
<p>在hosts中新增幾個IP</p>
<blockquote>
<p>vi /etc/hosts</p>
</blockquote>
<div class="highlight"><pre><span class="mf">127.0.0.1</span>   <span class="n">localhost</span>
<span class="mf">127.0.0.2</span>   <span class="n">wsgi</span><span class="p">.</span><span class="n">djangoserver</span>
<span class="mf">127.0.0.3</span>   <span class="n">hello</span><span class="p">.</span><span class="n">djangoserver</span>
</pre></div>


<h1>測試WSGI是否可以執行</h1>
<p>創建資料夾</p>
<blockquote>
<p>mkdir ~/django/myapp</p>
</blockquote>
<p>新增python的應用程式<code>wsgi.app</code></p>
<blockquote>
<p>vi ~/django/myapp/wsgi.app</p>
</blockquote>
<div class="highlight"><pre>    <span class="n">def</span> <span class="n">application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span><span class="o">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="err">&#39;</span><span class="mi">200</span> <span class="n">OK</span><span class="err">&#39;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">Hello</span> <span class="n">World</span><span class="o">!</span><span class="err">&#39;</span>

        <span class="n">response_headers</span> <span class="o">=</span> <span class="p">[(</span><span class="err">&#39;</span><span class="n">Content</span><span class="o">-</span><span class="n">type</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="err">&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="err">&#39;</span><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">str</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">output</span><span class="p">)))]</span>
        <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">output</span><span class="p">]</span>
</pre></div>


<p>新增apache的設定</p>
<blockquote>
<p>sudo vi /etc/apache2/sites-available/wsgi</p>
</blockquote>
<div class="highlight"><pre>    <span class="nt">&lt;VirtualHost</span> <span class="err">*:80</span><span class="nt">&gt;</span>

        ServerName wsgi.djangoserver
        DocumentRoot /home/lucas/django

        <span class="nt">&lt;Directory</span> <span class="err">/home/lucas/django</span><span class="nt">&gt;</span>
            Order allow,deny
            Allow from all
        <span class="nt">&lt;/Directory&gt;</span>

        WSGIScriptAlias / /home/lucas/django/myapp/wsgi.app         
    <span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>


<p>將設定檔生效</p>
<blockquote>
<p>sudo a2ensite
  sudo service apache2 reload</p>
</blockquote>
<p>測試你的wsgi是否有效
<a href="http://wsgi.djangoserver">http://wsgi.djangoserver</a>如果沒有看到<code>Hello World!</code>表示wsgi的設定就有問題了，可能需要先完成這個步驟，才可以繼續設定你的環境。</p>
<h1>測試Django是否可以安裝</h1>
<p>開啟一個Django的project</p>
<blockquote>
<p>mkdir ~/django
  python django-admin.py mysite</p>
</blockquote>
<p>設定一個網站的wsgi file</p>
<blockquote>
<p>mkdir ~/django/apache
  vi ~/django/apache/django.wsgi</p>
</blockquote>
<p>編輯<code>django.wsgi</code>的內容</p>
<div class="highlight"><pre><span class="n">import</span> <span class="n">os</span>
<span class="n">import</span> <span class="n">sys</span>

<span class="n">path</span> <span class="o">=</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">www</span><span class="err">&#39;</span>
<span class="k">if</span> <span class="n">path</span> <span class="n">not</span> <span class="n">in</span> <span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="o">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">www</span><span class="err">&#39;</span><span class="p">)</span>

<span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="err">&#39;</span><span class="n">DJANGO_SETTINGS_MODULE</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">hello</span><span class="p">.</span><span class="n">settings</span><span class="err">&#39;</span>

<span class="n">import</span> <span class="n">django</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">handlers</span><span class="p">.</span><span class="n">wsgi</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">django</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">handlers</span><span class="p">.</span><span class="n">wsgi</span><span class="p">.</span><span class="n">WSGIHandler</span><span class="p">()</span>
</pre></div>


<h2>新增一個apache site</h2>
<blockquote>
<p>sudo vi /etc/apache2/site-available/hello</p>
</blockquote>
<p>編輯<code>hello</code>的內容</p>
<p><VirtualHost *:80></p>
<div class="highlight"><pre><span class="nb">ServerName</span> <span class="nx">hello.djangoserver</span>
<span class="nb">DocumentRoot</span> <span class="p">/</span><span class="nx">srv</span><span class="p">/</span><span class="nx">www</span><span class="p">/</span><span class="nx">hello</span>

<span class="o">&lt;</span><span class="nx">Directory</span> <span class="p">/</span><span class="nx">srv</span><span class="p">/</span><span class="nx">www</span><span class="p">/</span><span class="nx">hello</span><span class="o">&gt;</span>
    <span class="k">Order</span> <span class="nx">allow</span><span class="p">,</span><span class="nx">deny</span>
    <span class="nx">Allow</span> <span class="nb">from</span> <span class="kc">all</span>
<span class="o">&lt;/</span><span class="nx">Directory</span><span class="o">&gt;</span>

<span class="nx">WSGIDaemonProcess</span> <span class="nx">hello.djangoserver</span> <span class="n">processes</span><span class="o">=</span><span class="mi">2</span> <span class="n">threads</span><span class="o">=</span><span class="mi">15</span> <span class="nx">display</span><span class="na">-name</span><span class="o">=%</span><span class="p">{</span><span class="k">GROUP</span><span class="p">}</span>
<span class="nx">WSGIProcessGroup</span> <span class="nx">hello.djangoserver</span>

<span class="nx">WSGIScriptAlias</span> <span class="o">/</span> <span class="p">/</span><span class="nx">srv</span><span class="p">/</span><span class="nx">www</span><span class="p">/</span><span class="nx">hello</span><span class="p">/</span><span class="nx">apache</span><span class="p">/</span><span class="nx">django.wsgi</span>

<span class="o">&lt;/</span><span class="nx">VirtualHost</span><span class="o">&gt;</span>
</pre></div>


<p>啟動apache site</p>
<blockquote>
<p>sudo a2ensite hello
  sudo /etc/init.d/apache2 reload</p>
</blockquote>
<p>使用瀏覽器啟動<a href="http://hello.djangoserver">http://hello.djangoserver</a>你就會看到歡迎頁面了</p>
<p>參考：
<a href="http://blog.stannard.net.au/2010/12/11/installing-django-with-apache-and-mod_wsgi-on-ubuntu-10-04/">Installing Django with Apache and mod_wsgi on Ubuntu 10.04</a>
<a href="http://library.linode.com/frameworks/django-apache-mod-wsgi/ubuntu-10.04-lucid#sph_configure-django-applications-for-wsgi">Django, Apache and mod_wsgi on Ubuntu 10.04 (Lucid)</a></p>
                </div><!-- /.entry-content -->
                        </article>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
            <ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-external-link"></i>blogroll</h4></li>
    <li><a href="http://getpelican.com/"><i class="icon-external-link"></i>Pelican</a></li>
    <li><a href="http://python.org/"><i class="icon-external-link"></i>Python.org</a></li>
    <li><a href="http://jinja.pocoo.org/"><i class="icon-external-link"></i>Jinja2</a></li>
    <li><a href="#"><i class="icon-external-link"></i>You can modify those links in your config file</a></li>
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
<li><a href="/" rel="alternate"><i class="icon-bookmark icon-large"></i>atom feed</a></li>
    <li><a href="#"><i class="icon-You can add links in your config file-sign icon-large"></i>You can add links in your config file</a></li>
    <li><a href="#"><i class="icon-Another social link-sign icon-large"></i>Another social link</a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="/category/python.html">
    <i class="icon-folder-open icon-large"></i>Python
</a>
</li>
<li>
<a href="/category/sql.html">
    <i class="icon-folder-open icon-large"></i>SQL
</a>
</li>

<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>
<li class="tag-4">
    <a href="/tag/sql.html">
        <i class="icon-tag icon-large"></i>SQL
    </a>
</li>
<li class="tag-4">
    <a href="/tag/pelican.html">
        <i class="icon-tag icon-large"></i>pelican
    </a>
</li>
<li class="tag-4">
    <a href="/tag/publishing.html">
        <i class="icon-tag icon-large"></i>publishing
    </a>
</li>
<li class="tag-2">
    <a href="/tag/django.html">
        <i class="icon-tag icon-large"></i>Django
    </a>
</li>
<li class="tag-1">
    <a href="/tag/ubuntu.html">
        <i class="icon-tag icon-large"></i>Ubuntu
    </a>
</li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

      <footer>
        <address id="about">
                Proudly powered by <a href="http://pelican.notmyidea.org/">Pelican <i class="icon-external-link"></i></a>,
                                which takes great advantage of <a href="http://python.org">Python <i class="icon-external-link"></i></a>.
        </address><!-- /#about -->

        <p>The theme is from <a href="http://twitter.github.com/bootstrap/">Bootstrap from Twitter <i class="icon-external-link"></i></a>,
                   and <a href="http://fortawesome.github.com/Font-Awesome/">Font-Awesome <i class="icon-external-link"></i></a>, thanks!</p>
      </footer>

    </div><!--/.fluid-container-->


            
    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/theme/js/jquery-1.7.2.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>
  </body>
</html>